from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup, ForceReply
from telegram.ext import ContextTypes, ConversationHandler, ApplicationHandlerStop, CallbackQueryHandler


import os



INFO_TEXTS = {
    "info_booking": {
        "title": "üçØ *–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–∫–∞–∑—É:*",
        "body": (
            "1. –ù–∞–∂–º–∏—Ç–µ /start –∏ –ø—Ä–æ–π–¥–∏—Ç–µ –∫–æ—Ä–æ—Ç–∫—É—é —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é;\n"
            "2. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ—Å—Ç–∞–≤–∏—Ç—å –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–ª—è –ª—É—á—à–µ–π –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏;\n"
            "3. –í—Ä–µ–º—è –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –¥–µ–≥—É—Å—Ç–∞—Ü–∏–∏ –∏–∑–≤–µ—Å—Ç–Ω–æ –∑–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π\n"
            "4. –ï—Å–ª–∏ –≤—ã –∑–∞–ø–∏—à–∏—Ç–µ—Å—å, —Ç–æ —Ä–æ–±–æ—Ç –ø—Ä–∏—à–ª–µ—Ç –≤–∞–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ\n"
            "5. –ú–µ–¥ –ø—Ä–æ–¥–∞–µ—Ç—Å—è –≤ —Ç–∞—Ä–µ –ø–æ 0.5, 1 –∏ 1.5 –∫–≥ \n"
            "6. –î–ª—è –∑–∞–∫–∞–∑–∞ –º–µ–¥–∞ –Ω—É–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å —Å–æ—Ä—Ç –∏ —Ä–∞–∑–º–µ—Ä\n"
            "7. –í –∫–∞—Ä—Ç–æ—á–∫–µ –∑–∞–∫–∞–∑–∞ –Ω–∞–∂–º–∏—Ç–µ ‚ûï,\n"
            "–µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ 2 –∏–ª–∏ –±–æ–ª–µ–µ –±–∞–Ω–∫–∏ —ç—Ç–æ–≥–æ —Å–æ—Ä—Ç–∞\n"
            "8. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–∫–∞–∑—É –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –Ω–∞–ø–∏—Å–∞—Ç—å –ø—Ä–æ–¥–∞–≤—Ü—É\n"
            "9. –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É –ó–∞–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –∑–∞–∫–∞–∑\n"
            "10. –ö–æ–≥–¥–∞ –ø—Ä–æ–¥–∞–≤–µ—Ü –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç –≤–∞—à –∑–∞–∫–∞–∑, –≤–∞–º –ø—Ä–∏–¥–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ\n"
            "11. –í —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–∏ –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É –°–µ–≥–æ–¥–Ω—è/–ó–∞–≤—Ç—Ä–∞ –∏–ª–∏ –ü–æ–∑–∂–µ,\n"
            "—á—Ç–æ–±—ã –ø—Ä–æ–∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–¥–∞–≤—Ü–∞, –∫–æ–≥–¥–∞ –ø—Ä–∏–º–µ—Ä–Ω–æ –≤—ã –ø—Ä–∏–¥–µ—Ç–µ –∑–∞ –º—ë–¥–æ–º.\n"
            "12. –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç–∏, –Ω–∞–ø–∏—à–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª '–ü–æ–º–æ—â—å'."
        )
    },
    "info_object": {
        "title": "üßæ *–ü—Ä–∞–≤–∏–ª–∞ —Å–µ—Ä–≤–∏—Å–∞*",
        "body": (
            "1. EasySochi —è–≤–ª—è–µ—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–º —Å–µ—Ä–≤–∏—Å–æ–º (—á–∞—Ç-–±–æ—Ç–æ–º) –∏ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —Å—Ç–æ—Ä–æ–Ω–æ–π —Å–¥–µ–ª–æ–∫ –ø–æ–∫—É–ø–∫–∏.\n"
            "2. –°–µ—Ä–≤–∏—Å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–ª–∞—Ç—Ñ–æ—Ä–º—É –¥–ª—è –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ –º–µ–∂–¥—É –ø—Ä–æ–¥–∞–≤—Ü–æ–º –∏ –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–º.\n"
            "3. –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∑–∞ –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω–æ—Å—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ (–æ–ø–∏—Å–∞–Ω–∏—è, —Ñ–æ—Ç–æ, —Ü–µ–Ω—ã) –Ω–µ—Å—ë—Ç –ª–∏—Ü–æ, –µ—ë —Ä–∞–∑–º–µ—Å—Ç–∏–≤—à–µ–µ.\n"
            "4. –í—Å–µ –¥–æ–≥–æ–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç–∏ –æ –ø–æ–∫—É–ø–∫–µ –∑–∞–∫–ª—é—á–∞—é—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –º–µ–∂–¥—É —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∏–∫–æ–º –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.\n"
            "5. EasySochi –Ω–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –∏ –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤ —Å—Ç–æ—Ä–æ–Ω.\n"
            "6. –°–µ—Ä–≤–∏—Å —Å—Ç—Ä–µ–º–∏—Ç—Å—è –æ–±–µ—Å–ø–µ—á–∏–≤–∞—Ç—å –±–µ—Å–ø–µ—Ä–µ–±–æ–π–Ω—É—é —Ä–∞–±–æ—Ç—É —á–∞—Ç-–±–æ—Ç–∞, –Ω–æ –Ω–µ –Ω–µ—Å—ë—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ –ø–µ—Ä–µ–±–æ–∏ —Å–≤—è–∑–∏ –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Telegram.\n"
            "7. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç —Å–≤–æ–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–æ–±—Ä–æ–≤–æ–ª—å–Ω–æ.\n"
            "8. –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –æ–±—ä—ë–º–µ, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–º –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–µ—Ä–≤–∏—Å–∞ (—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –ø–æ–∏—Å–∫, –∑–∞–∫–∞–∑, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è).\n"
            "9. EasySochi –æ–±—è–∑—É–µ—Ç—Å—è –Ω–µ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ —Ç—Ä–µ—Ç—å–∏–º –ª–∏—Ü–∞–º, –∫—Ä–æ–º–µ —Å–ª—É—á–∞–µ–≤, –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã—Ö –∑–∞–∫–æ–Ω–æ–º.\n"
            "10. –ò—Å–ø–æ–ª—å–∑—É—è —Å–µ—Ä–≤–∏—Å, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç, —á—Ç–æ –æ–∑–Ω–∞–∫–æ–º–ª–µ–Ω —Å –¥–∞–Ω–Ω—ã–º–∏ —É—Å–ª–æ–≤–∏—è–º–∏ –∏ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∏—Ö.\n"
        )
    }
}


def _get_effective_message(update: Update):
    """
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç message-–æ–±—ä–µ–∫—Ç, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ç–æ–≥–æ, –ø—Ä–∏—à–ª–æ –ª–∏ —ç—Ç–æ update.message
    –∏–ª–∏ —ç—Ç–æ callback_query (update.callback_query.message).
    """
    if update.message:
        return update.message
    if update.callback_query and update.callback_query.message:
        return update.callback_query.message
    return None


async def info_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """
    –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–µ–Ω—é —Å–ø—Ä–∞–≤–∫–∏. –†–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –ø—Ä–∏ –ø—Ä—è–º–æ–º –≤—ã–∑–æ–≤–µ /info, —Ç–∞–∫ –∏ –ø—Ä–∏ callback.
    """
    message = _get_effective_message(update)
    if not message:
        return

    keyboard = [
        [InlineKeyboardButton("üìå –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è", callback_data="info_booking"),
        InlineKeyboardButton("–ü—Ä–∞–≤–∏–ª–∞ –∏ —É—Å–ª–æ–≤–∏—èüñã", callback_data="info_object")]
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)
    await message.reply_text("‚ÑπÔ∏è –í—ã–±–µ—Ä–∏—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é:", reply_markup=reply_markup)


async def show_info_text(update_or_query: Update, key: str):
    """
    –í—ã–≤–æ–¥–∏—Ç —Å–ø—Ä–∞–≤–æ—á–Ω—ã–π —Ç–µ–∫—Å—Ç –ø–æ –∫–ª—é—á—É. –†–∞–±–æ—Ç–∞–µ—Ç –∏ –¥–ª—è –æ–±—ã—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π, –∏ –¥–ª—è callback.
    –ö–Ω–æ–ø–∫–∞ '–ù–∞–∑–∞–¥ –≤ –∏–Ω—Ñ–æ' –∏–º–µ–µ—Ç callback_data='help_menu'.
    """
    data = INFO_TEXTS.get(key)
    if not data:
        return

    text = f"{data['title']}\n\n{data['body']}"
    markup = InlineKeyboardMarkup(
        [[InlineKeyboardButton("‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –≤ –∏–Ω—Ñ–æ", callback_data="info_menu")]]
    )

    message = _get_effective_message(update_or_query)
    if not message:
        return

    # –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å edit_message_text –µ—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –∑–∞–º–µ–Ω–∏—Ç—å –ø—Ä–µ–¥—ã–¥—É—â—É—é –∫–∞—Ä—Ç–æ—á–∫—É,
    # –Ω–æ reply_text –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —É–Ω–∏–≤–µ—Ä—Å–∞–ª–µ–Ω.
    await message.reply_text(text, parse_mode="Markdown", reply_markup=markup)


async def info_callback_handler(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """
    –û–±—Ä–∞–±–æ—Ç—á–∏–∫ callback'–æ–≤ –¥–ª—è help_*
    - –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ query (query.answer())
    - –≤—ã–∑—ã–≤–∞–µ—Ç show_help_text –∏–ª–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤ –º–µ–Ω—é –≤—ã–∑–æ–≤–æ–º help_command
    """
    query = update.callback_query
    if not query:
        return

    await query.answer()  # —É–±–∏—Ä–∞–µ–º "–∫—Ä—É—Ç–∏–ª–∫—É" –≤ UI

    data = query.data or ""
    if data == "info_booking":
        await show_info_text(update, "info_booking")
    elif data == "info_object":
        await show_info_text(update, "info_object")
    elif data == "info_menu":
        await info_command(update, context)
    else:
        return